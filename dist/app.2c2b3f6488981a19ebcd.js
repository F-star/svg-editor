(()=>{"use strict";var t={843:(t,e,n)=>{n.r(e),n.d(e,{NS:()=>r});var r={HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}},322:(t,e,n)=>{function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.r(e),n.d(e,{EditorEventContext:()=>o});var o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mousePressed=!1,this.originEvent=n,this.editor=e,this.isEndInside=!1,this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.startClientX=0,this.startClientY=0,this.dx=0,this.dy=0,this.setStartPos()}var e,n,o;return e=t,(n=[{key:"setOriginEvent",value:function(t){this.originEvent=t}},{key:"setStartPos",value:function(){var t=this.getPos(),e=t.x,n=t.y;this.startX=e,this.startY=n,this.startClientX=this.originEvent.clientX,this.startClientY=this.originEvent.clientY}},{key:"releaseMouse",value:function(){this.mousePressed=!1}},{key:"pressMouse",value:function(){this.mousePressed=!0}},{key:"getPos",value:function(){var t=this.editor.getZoom(),e=this.editor.getContentOffset(),n=e.x,r=e.y;return{x:this.originEvent.offsetX/t-n,y:this.originEvent.offsetY/t-r}}},{key:"getStartPos",value:function(){return{x:this.startX,y:this.startY}}},{key:"getDiffPos",value:function(){return{x:this.originEvent.clientX-this.startClientX,y:this.originEvent.clientY-this.startClientY}}}])&&r(e.prototype,n),o&&r(e,o),t}()},944:(t,e,n)=>{function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t){var e=t.getAttribute("viewBox");if(!e)throw new Error("has not viewBox attribute");var n=r(e.split(/[\s,]+/).map((function(t){return parseFloat(t)})),4);return{x:n[0],y:n[1],w:n[2],h:n[3]}}n.r(e),n.d(e,{getViewBox:()=>i})}},e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function n(e,r,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),"object"==t(e)?(this.x=e.x,this.y=e.y,this.w=e.width,this.h=e.height):(this.x=e,this.y=r,this.w=o,this.h=i),this.width=this.w,this.height=this.h,this.x2=this.x+this.w,this.y2=this.y+this.h}var r,o,i;return r=n,(o=[{key:"contains",value:function(t){return this.x<=t.x&&this.y<=t.y&&this.x2>=t.x+t.width&&this.y2>=t.y+t.height}},{key:"merge",value:function(t){var e=Math.min(this.x,t.x),r=Math.min(this.y,t.y);return new n(e,r,Math.max(this.x2,t.x2)-e,Math.max(this.y2,t.y2)-r)}}])&&e(r.prototype,o),i&&e(r,i),n}(),o=n(843);function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el_=null}var e,n,r;return e=t,(n=[{key:"el",value:function(){return this.el_}},{key:"setAttr",value:function(t,e){return this.el_.setAttribute(t,e)}},{key:"getAttr",value:function(t){return this.el_.getAttribute(t)}},{key:"getBBox",value:function(){return this.el_.getBBox()}},{key:"remove",value:function(){return this.el_.remove()}},{key:"parent",value:function(){return new m.Group(this.el_.parentElement)}},{key:"nextSibling",value:function(){var t=this.el_.nextElementSibling;return null==t?t:m.create(t)}},{key:"previousSibling",value:function(){var t=this.el_.previousSibling;return null==t?t:m.create(t)}},{key:"append",value:function(t){this.el_.appendChild(t.el())}},{key:"front",value:function(){this.el_.parentElement.appendChild(this.el_)}},{key:"back",value:function(){var t=this.el_.parentElement,e=t.firstElementChild;e&&t.insertBefore(this.el_,e)}},{key:"forward",value:function(){var t=this.el_.parentElement,e=referElement.nextSibling;e&&t.insertBefore(e,this.el_)}},{key:"backward",value:function(){var t=referElement.previousSibling;t&&this.before(t)}},{key:"before",value:function(t){t.el&&(t=t.el()),t.parentElement.insertBefore(this.el_,t)}},{key:"after",value:function(t){t.el&&(t=t.el());var e=t.parentElement,n=t.nextSibling;n?e.insertBefore(this.el_,n):e.appendChild(this.el_)}}])&&i(e.prototype,n),r&&i(e,r),t}();function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h(t);if(e){var o=h(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return f(this,n)}}function f(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=p(t);if(e){var o=p(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return g(this,n)}}function g(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m={create:function(t){var e=t.tagName;if("rect"===e)return new m.Rect(t);if("g"===e)return new m.Group(t);throw new Error("Can not creat ".concat(e," instance, no match class."))},Rect:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(a,t);var e,n,r,i=c(a);function a(t,e,n,r){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),u=i.call(this),"object"==s(t)?u.el_=t:(u.el_=document.createElementNS(o.NS.SVG,"rect"),u.setAttr("x",t),u.setAttr("y",e),u.setAttr("width",n),u.setAttr("height",r)),u}return e=a,(n=[{key:"getPos",value:function(){return{x:parseFloat(this.getAttr("x")),y:parseFloat(this.getAttr("y"))}}},{key:"dmove",value:function(t,e){var n=this.getPos();this.setAttr("x",n.x+t),this.setAttr("y",n.y+e)}}])&&u(e.prototype,n),r&&u(e,r),a}(a),Box:r,Group:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(n,t);var e=y(n);function n(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(r=e.call(this)).el_=t||document.createElementNS(o.NS.SVG,"g"),r}return n}(a)};function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var w=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.els=[]}var e,n,r;return e=t,(n=[{key:"setEls",value:function(t){Array.isArray(t)||(t=[t]),this.els=t,this.heighligthEls(),this.setSettingFill()}},{key:"getEls",value:function(){return this.els}},{key:"setElsInBox",value:function(t){if(0!==t.width&&0!==t.height){var e=function(t,e){var n=["g"];t=new m.Box(t);var r=[];return function t(e,o){for(var i=o.children,a=0;a<i.length;a++){var s=i[a];if(!n.includes(s.tagName)){var u=s.getBBox();e.contains(u)&&r.push(m.create(s))}s.children.length>0&&t(e,s)}}(t,e),r}(t,this.editor.svgContent);0===e.length?this.clear():this.setEls(e)}else this.clear()}},{key:"isEmpty",value:function(){return 0==this.els.length}},{key:"isNoEmpty",value:function(){return this.els.length>0}},{key:"clear",value:function(){this.els=[],this.editor.hudManager.outlineBoxHud.clear()}},{key:"contains",value:function(t){for(var e=0;e<this.els.length;e++)if(this.els[e].el()===t)return!0;return!1}},{key:"getMergeBBox",value:function(){}},{key:"heighligthEls",value:function(){var t=this.els,e=this.editor.hudManager,n=new m.Box(t[0].getBBox()),r=t.reduce((function(t,e){var n=e.getBBox();return t.merge(new m.Box(n))}),n);e.outlineBoxHud.drawRect(r.x,r.y,r.width,r.height)}},{key:"setSettingFill",value:function(){var t=this.els.map((function(t){return t.getAttr("fill")}));this.editor.setting.setFill(t[0])}},{key:"setElsAttr",value:function(t,e){this.isNoEmpty()&&this.editor.executeCommand("setAttr",this.els,t,e)}}])&&b(e.prototype,n),r&&b(e,r),t}();function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var E=n(843).NS,x=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=0,this.y=0,this.w=0,this.h=0,this.container=document.createElementNS(E.SVG,"g"),this.container.id="outline-box-hud",e.appendChild(this.container),this.outline=document.createElementNS(E.SVG,"path"),this.outline.setAttribute("fill","none"),this.outline.setAttribute("stroke","#f04"),this.outline.setAttribute("vector-effect","non-scaling-stroke"),this.container.appendChild(this.outline)}var e,n,r;return e=t,(n=[{key:"clear",value:function(){this.outline.style.display="none"}},{key:"drawRect",value:function(t,e,n,r){this.x=t,this.y=e,this.w=n,this.h=r;var o="M ".concat(t," ").concat(e," L ").concat(t+n," ").concat(e," L ").concat(t+n," ").concat(e+r," L ").concat(t," ").concat(e+r," Z");this.outline.setAttribute("d",o),this.outline.style.display=""}},{key:"getWidth",value:function(){return this.w}},{key:"getHeight",value:function(){return this.h}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}}])&&k(e.prototype,n),r&&k(e,r),t}();function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var C=n(843).NS,M=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=0,this.y=0,this.w=0,this.h=0,this.container=document.createElementNS(C.SVG,"g"),this.container.id="select-area",e.appendChild(this.container),this.outline=document.createElementNS(C.SVG,"path"),this.outline.setAttribute("fill","none"),this.outline.setAttribute("stroke","#054"),this.outline.setAttribute("vector-effect","non-scaling-stroke"),this.outline.setAttribute("stroke-dasharray","4px"),this.container.appendChild(this.outline)}var e,n,r;return e=t,(n=[{key:"clear",value:function(){this.x=this.y=this.w=this.h=0,this.outline.style.display="none"}},{key:"drawRect",value:function(t,e,n,r){this.x=t,this.y=e,this.w=n,this.h=r;var o="M ".concat(t," ").concat(e," L ").concat(t+n," ").concat(e," L ").concat(t+n," ").concat(e+r," L ").concat(t," ").concat(e+r," Z");this.outline.setAttribute("d",o),this.outline.style.display=""}},{key:"getWidth",value:function(){return this.w}},{key:"getHeight",value:function(){return this.h}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getBox",value:function(){return{x:this.x,y:this.y,width:this.w,height:this.h,w:this.w,h:this.h}}}])&&S(e.prototype,n),r&&S(e,r),t}();function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var A=n(843).NS,P=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=document.createElementNS(A.SVG,"g"),this.container.id="huds",this.selectArea=new M(this.container),this.outlineBoxHud=new x(this.container)}var e,n,r;return e=t,(n=[{key:"mount",value:function(t){t.appendChild(this.container)}}])&&O(e.prototype,n),r&&O(e,r),t}();function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.registeredFns={},window.addEventListener("keydown",(function(t){var e=function(t){var e=[];t.ctrlKey&&e.push("Ctrl");t.metaKey&&e.push("Cmd");t.shiftKey&&e.push("Shift");/Key./.test(t.code)?e.push(t.code[t.code.length-1]):e.push(t.code);return e.join("+")}(t),r=n.registeredFns[e];r&&(console.log(e),t.preventDefault(),r.fn(t))}),!1)}var e,n,r;return e=t,(n=[{key:"register",value:function(t,e,n){this.registeredFns[e]={cmdName:t,fn:n}}},{key:"formatPrint",value:function(){var t=[];for(var e in this.registeredFns){var n=this.registeredFns[e].cmdName;t.push(n+": "+e)}return t.join(", ")}}])&&T(e.prototype,n),r&&T(e,r),t}();function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const j=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.setting=null,this.commandManager=null,this.zoomManager=null,this.activedElsManager=new w(this),this.shortcut=new _(this);var e=document.createElement("div");e.id="viewport",e.style.border="1px solid #000",e.style.width="800px",e.style.height="550px",this.viewport=e;var n=document.createElement("div");n.id="svg-container",n.style.backgroundColor="#ddd",n.style.width="800px",n.style.height="550px",n.style.overflow="scroll",this.svgContainer=n;var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.id="svg-root",r.setAttribute("width",1e3),r.setAttribute("height",600),r.setAttribute("viewBox","0 0 1000 600"),this.svgRoot=r;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.id="svg-stage",o.setAttribute("width",400),o.setAttribute("height",300),o.setAttribute("x",300),o.setAttribute("y",150),o.style.overflow="visible",this.svgStage=o;var i=document.createElementNS("http://www.w3.org/2000/svg","g");i.id="background",i.setAttribute("x",0),i.setAttribute("y",0);var a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill","#fff");var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.id="content",s.setAttribute("x",0),s.setAttribute("y",0),this.svgContent=s;var u=document.createElementNS("http://www.w3.org/2000/svg","g");u.id="layer-1",this.currentLayer=u,e.appendChild(n),n.appendChild(r),r.appendChild(o),o.appendChild(i),i.appendChild(a),o.appendChild(s),s.appendChild(u),this.hudManager=new P,this.hudManager.mount(o)}var e,n,r;return e=t,(n=[{key:"mount",value:function(t){document.querySelector(t).appendChild(this.viewport)}},{key:"getCurrentLayer",value:function(){return this.currentLayer}},{key:"setToolManager",value:function(t){this.toolManager=t}},{key:"setCurrentTool",value:function(t){this.toolManager.setCurrentTool(t)}},{key:"registerTool",value:function(t){this.toolManager.registerTool(t)}},{key:"setSetting",value:function(t){this.setting=t}},{key:"setCursor",value:function(t){this.svgRoot.style.cursor=t}},{key:"setCommandManager",value:function(t){this.commandManager=t}},{key:"executeCommand",value:function(t){var e;if("undo"!=t)if("redo"!=t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=this.commandManager).execute.apply(e,[t].concat(r))}else this.commandManager.redo();else this.commandManager.undo()}},{key:"setZoomManager",value:function(t){t.setEditor(this),this.zoomManager=t}},{key:"getZoom",value:function(){return this.zoomManager.getZoom()}},{key:"getScroll",value:function(){return{x:this.svgContainer.scrollLeft,y:this.svgContainer.scrollTop}}},{key:"setScroll",value:function(t,e){this.svgContainer.scrollLeft=t,this.svgContainer.scrollTop=e}},{key:"getContentOffset",value:function(){return{x:this.svgStage.getAttribute("x"),y:this.svgStage.getAttribute("y")}}},{key:"isContentElement",value:function(t){for(;t;){if(t.parentElement==this.svgContent)return!0;if(t.parentElement==this.svgRoot)return!1;t=t.parentElement}return!1}}])&&R(e.prototype,n),r&&R(e,r),t}();function B(t,e,n,r){var o,i;return o=Math.abs(n-t),i=Math.abs(r-e),{x:Math.min(n,t),y:Math.min(r,e),w:o,h:i}}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const L=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=null}var e,n,r;return e=t,(n=[{key:"setEditor",value:function(t){this.editor=t}},{key:"name",value:function(){return"addRect"}},{key:"cursorNormal",value:function(){return"crosshair"}},{key:"cursorPress",value:function(){return"crosshair"}},{key:"start",value:function(t){}},{key:"move",value:function(t){var e=t.getPos(),n=e.x,r=e.y,o=t.getStartPos(),i=B(o.x,o.y,n,r),a=i.x,s=i.y,u=i.w,l=i.h;this.editor.hudManager.outlineBoxHud.drawRect(a,s,u,l)}},{key:"end",value:function(t){this.editor.hudManager.outlineBoxHud.clear();var e=t.getPos(),n=e.x,r=e.y,o=t.getStartPos(),i=B(o.x,o.y,n,r),a=i.x,s=i.y,u=i.w,l=i.h;u<2&&l<2?console.log("width and height both less equal to 2，drawing nothing"):this.editor.executeCommand("addRect",a,s,u,l)}},{key:"endOutside",value:function(){this.editor.hudManager.outlineBoxHud.clear()}}])&&N(e.prototype,n),r&&N(e,r),t}();function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var X=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=null,this.startOffsetX=0,this.startOffsetY=0}var e,n,r;return e=t,(n=[{key:"setEditor",value:function(t){this.editor=t}},{key:"name",value:function(){return"dragCanvas"}},{key:"cursorNormal",value:function(){return"grab"}},{key:"cursorPress",value:function(){return"grabbing"}},{key:"beforeActive",value:function(){}},{key:"start",value:function(t){var e=this.editor.getScroll();this.startOffsetX=e.x,this.startOffsetY=e.y}},{key:"move",value:function(t){this.editor.getZoom();var e=t.getDiffPos(),n=e.x,r=e.y;this.editor.setScroll(this.startOffsetX-n,this.startOffsetY-r)}},{key:"end",value:function(){}},{key:"endOutside",value:function(){}}])&&F(e.prototype,n),r&&F(e,r),t}();function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=V(t);if(e){var o=V(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return D(this,n)}}function D(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function G(t,e,n){return e&&z(t.prototype,e),n&&z(t,n),t}var W=function(){function t(){I(this,t)}return G(t,[{key:"undo",value:function(){throw new Error("please override undo method")}},{key:"redo",value:function(){throw new Error("please override redo method")}},{key:"afterRedo",value:function(){}},{key:"afterUndo",value:function(){}}]),t}(),U=function(t){q(n,t);var e=Z(n);function n(t,r,o,i,a){var s;I(this,n),(s=e.call(this)).editor=t;var u=new m.Rect(r,o,i,a),l=t.setting.get("fill"),c=t.setting.get("stroke"),f=t.setting.get("strokeWidth");return u.setAttr("fill",l),u.setAttr("stroke",c),u.setAttr("stroke-width",f),t.getCurrentLayer().appendChild(u.el()),s.nextSibling=u.el().nextElementSibling,s.parent=u.el().parentElement,s.rect=u,s.editor.activedElsManager.setEls(s.rect),s}return G(n,[{key:"redo",value:function(){var t=this.rect.el();this.nextSibling?this.parent.insertBefore(t,this.nextSibling):this.parent.appendChild(t),this.editor.activedElsManager.setEls(this.rect)}},{key:"undo",value:function(){this.rect.el().remove(),this.editor.activedElsManager.clear()}}],[{key:"name",value:function(){return"addRect"}}]),n}(W),K=function(t){q(n,t);var e=Z(n);function n(t){var r;I(this,n),(r=e.call(this)).editor=t,r.els=r.editor.activedElsManager.getEls();var o=r.els.length;return r.parents=new Array(o),r.nextSiblings=new Array(o),r.els.forEach((function(t,e){r.nextSiblings[e]=t.el().nextElementSibling,r.parents[e]=t.el().parentElement})),r.execute(),r}return G(n,[{key:"execute",value:function(){this.els.forEach((function(t){t.remove()})),this.editor.activedElsManager.clear()}},{key:"redo",value:function(){this.execute()}},{key:"undo",value:function(){for(var t=this.els.length-1;t>=0;t--){var e=this.els[t].el();this.nextSiblings[t]?this.parents[t].insertBefore(e,this.nextSiblings[t]):this.parents[t].appendChild(e)}this.editor.activedElsManager.setEls(this.els)}}],[{key:"name",value:function(){return"removeSelectedElements"}}]),n}(W),$=function(t){q(n,t);var e=Z(n);function n(t,r,o,i){var a;return I(this,n),(a=e.call(this)).editor=t,a.dx=o,a.dy=i,a.els=r,a.els.forEach((function(t){t.dmove(a.dx,a.dy)})),a}return G(n,[{key:"redo",value:function(){var t=this;this.els.forEach((function(e){e.dmove(t.dx,t.dy)}))}},{key:"undo",value:function(){var t=this;this.els.forEach((function(e){e.dmove(-t.dx,-t.dy)}))}},{key:"afterRedo",value:function(){this.editor.activedElsManager.setEls(this.els)}},{key:"afterUndo",value:function(){this.editor.activedElsManager.setEls(this.els)}}],[{key:"name",value:function(){return"dmove"}}]),n}(W),J=function(t){q(n,t);var e=Z(n);function n(t,r,o,i){var a;return I(this,n),(a=e.call(this)).editor=t,Array.isArray(r)||(r=[r]),a.els=r,a.attrName=o,a.beforeVal=a.els.map((function(t){return t.getAttr(o)})),a.afterVal=i,a.els.forEach((function(t){t.setAttr(o,i)})),a}return G(n,[{key:"redo",value:function(){var t=this;this.els.forEach((function(e){e.setAttr(t.attrName,t.afterVal)}))}},{key:"undo",value:function(){var t=this;this.els.forEach((function(e,n){e.setAttr(t.attrName,t.beforeVal[n])}))}}],[{key:"name",value:function(){return"setAttr"}}]),n}(W);function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nt(t,e,n){return e&&et(t.prototype,e),n&&et(t,n),t}function rt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function it(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=st(t);if(e){var o=st(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return at(this,n)}}function at(t,e){return!e||"object"!==Q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function st(t){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ut=function(t){rt(n,t);var e=it(n);function n(t,r){var o;if(tt(this,n),(o=e.call(this)).els=void 0===r?t.activedElsManager.getEls():r,0===o.els.length)throw new Error("elements can not be empty.");o.nextSiblings=new Array(o.els.length);for(var i=0;i<o.els.length;i++){var a=o.els[i];o.nextSiblings[i]=a.nextSibling(),a.front()}return o}return nt(n,[{key:"undo",value:function(){for(var t=this.els.length-1;t>=0;t--){var e=this.els[t],n=this.nextSiblings[t];null!==n&&e.before(n)}}},{key:"redo",value:function(){for(var t=0;t<this.els.length;t++){this.els[t].front()}}}],[{key:"name",value:function(){return"front"}}]),n}(W),lt=function(t){rt(n,t);var e=it(n);function n(t,r){var o;if(tt(this,n),(o=e.call(this)).els=void 0===r?t.activedElsManager.getEls():r,0===o.els.length)throw new Error("elements can not be empty.");o.previousSiblings=new Array(o.els.length);for(var i=o.els.length-1;i>=0;i--){var a=o.els[i];o.previousSiblings[i]=a.previousSibling()}return o.exec(),o}return nt(n,[{key:"undo",value:function(){for(var t=this.els.length,e=0;e<t;e++){var n=this.els[e],r=this.previousSiblings[e];null!==r&&n.after(r)}}},{key:"redo",value:function(){this.exec()}},{key:"exec",value:function(){for(var t=this.els.length-1;t>=0;t--){this.els[t].back()}}}],[{key:"name",value:function(){return"back"}}]),n}(W),ct=function(t){rt(n,t);var e=it(n);function n(t,r){var o;if(tt(this,n),(o=e.call(this)).els=void 0===r?t.activedElsManager.getEls():r,0===o.els.length)throw new Error("elements can not be empty.");return o.exec(),o}return nt(n,[{key:"exec",value:function(){for(var t=null,e=this.els.length-1;e>=0;e--){var n=this.els[e],r=n.el().nextSibling;null!==t&&r===t||r&&n.after(r),t=n.el()}}},{key:"undo",value:function(){for(var t=null,e=0;e<this.els.length;e++){var n=this.els[e],r=n.el().previousSibling;null!==t&&r===t||r&&n.before(r),t=n.el()}}},{key:"redo",value:function(){this.exec()}}],[{key:"name",value:function(){return"forward"}}]),n}(W),ft=function(t){rt(n,t);var e=it(n);function n(t,r){var o;if(tt(this,n),(o=e.call(this)).els=void 0===r?t.activedElsManager.getEls():r,0===o.els.length)throw new Error("elements can not be empty.");return o.exec(),o}return nt(n,[{key:"exec",value:function(){for(var t=null,e=0;e<this.els.length;e++){var n=this.els[e],r=n.el().previousSibling;null!==t&&r===t||r&&n.before(r),t=n.el()}}},{key:"undo",value:function(){for(var t=null,e=this.els.length-1;e>=0;e--){var n=this.els[e],r=n.el().nextSibling;null!==t&&r===t||r&&n.after(r),t=n.el()}}},{key:"redo",value:function(){this.exec()}}],[{key:"name",value:function(){return"backward"}}]),n}(W);function ht(t,e,n){return(ht=dt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&vt(o,n.prototype),o}).apply(null,arguments)}function dt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const gt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.redoStack=[],this.undoStack=[],this.commandClasses={},this.resigterCommandClass(U),this.resigterCommandClass($),this.resigterCommandClass(J),this.resigterCommandClass(K),this.resigterCommandClass(ut),this.resigterCommandClass(lt),this.resigterCommandClass(ct),this.resigterCommandClass(ft)}var e,n,r;return e=t,(n=[{key:"setEditor",value:function(t){this.editor=t}},{key:"execute",value:function(t){var e=this.commandClasses[t];if(!e)throw new Error("editor has not the ".concat(t," command"));for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=ht(e,[this.editor].concat(r));this.undoStack.push(i),this.redoStack=[]}},{key:"undo",value:function(){if(0!==this.undoStack.length){var t=this.undoStack.pop();this.redoStack.push(t),t.undo(),t.afterUndo()}else console.log("undo stack is empty, can not undo")}},{key:"redo",value:function(){if(0!==this.redoStack.length){var t=this.redoStack.pop();this.undoStack.push(t),t.redo(),t.afterRedo()}else console.log("redo stack is empty, can not redo")}},{key:"resigterCommandClass",value:function(t){var e=t.name();this.commandClasses[e]=t}},{key:"afterAnyUndo",value:function(){}}])&&yt(e.prototype,n),r&&yt(e,r),t}();function pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var mt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.setting={},this.bindedEventFns={},this.setFill("#fff"),this.setStroke("#000"),this.set("strokeWidth","1px")}var e,n,r;return e=t,(n=[{key:"setFill",value:function(t){this.set("fill",t)}},{key:"setStroke",value:function(t){this.set("stroke",t)}},{key:"set",value:function(t,e){this.setting[t]=e;var n=this.bindedEventFns[t];n&&n.forEach((function(t){t(e)}))}},{key:"get",value:function(t){return this.setting[t]}},{key:"bindEvent",value:function(t,e){this.bindedEventFns[t]||(this.bindedEventFns[t]=[]),this.bindedEventFns[t].push(e)}},{key:"removeEvent",value:function(t,e){if(!this.bindedEventFns[t])return!1;var n=this.bindedEventFns[t].findIndex(e);return-1!==n&&(this.bindedEventFns.splice(n,1),!0)}}])&&pt(e.prototype,n),r&&pt(e,r),t}();function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var wt=n(944).getViewBox,kt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=null}var e,n,r;return e=t,(n=[{key:"setEditor",value:function(t){this.editor=t}},{key:"getZoom",value:function(){return parseFloat(this.editor.svgRoot.getAttribute("width"))/wt(this.editor.svgRoot).w}},{key:"setZoom",value:function(t){console.log(t);var e=wt(this.editor.svgRoot),n=e.w*t,r=e.h*t;this.editor.svgRoot.setAttribute("width",n),this.editor.svgRoot.setAttribute("height",r)}},{key:"zoomIn",value:function(){var t=this.getZoom();this.setZoom(t+.1)}},{key:"zoomOut",value:function(){var t=this.getZoom();this.setZoom(t-.1)}}])&&bt(e.prototype,n),r&&bt(e,r),t}();function Et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var xt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=null,this.selectedEls=[],this.outlineStartX=0,this.outlineStartY=0}var e,n,r;return e=t,(n=[{key:"setEditor",value:function(t){this.editor=t}},{key:"name",value:function(){return"select"}},{key:"cursorNormal",value:function(){return"default"}},{key:"cursorPress",value:function(){return"default"}},{key:"hasSelectedElsWhenStart",value:function(){return this.selectedEls.length>0}},{key:"start",value:function(t){var e=t.originEvent.target;if(this.editor.isContentElement(e)){var n=m.create(e),r=this.editor.activedElsManager;r.contains(e)?r.heighligthEls():r.setEls(n),this.selectedEls=r.getEls();var o=this.editor.hudManager.outlineBoxHud;this.outlineStartX=o.getX(),this.outlineStartY=o.getY()}}},{key:"move",value:function(t){if(this.hasSelectedElsWhenStart()){var e=t.getDiffPos(),n=e.x,r=e.y,o=this.editor.hudManager.outlineBoxHud,i=o.getWidth(),a=o.getHeight();o.drawRect(this.outlineStartX+n,this.outlineStartY+r,i,a)}else{var s=t.getPos(),u=s.x,l=s.y,c=t.getStartPos(),f=B(c.x,c.y,u,l),h=f.x,d=f.y,v=f.w,y=f.h;this.editor.hudManager.selectArea.drawRect(h,d,v,y)}}},{key:"end",value:function(t){if(!this.hasSelectedElsWhenStart()){var e=this.editor.hudManager.selectArea.getBox();return this.editor.hudManager.selectArea.clear(),void this.editor.activedElsManager.setElsInBox(e)}this.editor.hudManager.outlineBoxHud.clear();var n=t.getDiffPos(),r=n.x,o=n.y;this.editor.executeCommand("dmove",this.selectedEls,r,o),this.editor.activedElsManager.setEls(this.selectedEls),this.selectedEls=[]}},{key:"endOutside",value:function(){this.editor.hudManager.outlineBoxHud.clear(),this.editor.hudManager.selectArea.clear(),this.editor.activedElsManager.clear(),this.selectedEls=[]}}])&&Et(e.prototype,n),r&&Et(e,r),t}();function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ct=n(322).EditorEventContext,Mt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.tools={},this.currentTool=null,this.invokeWhenSwitch=function(){},this.ctx=null}var e,n,r;return e=t,(n=[{key:"setCurrentTool",value:function(t){this.currentTool=this.tools[t];var e=this.currentTool.cursorNormal();this.editor.setCursor(e);var n=this.getCurrentToolName();this.invokeWhenSwitch(n)}},{key:"onSwitchTool",value:function(t){this.invokeWhenSwitch=t}},{key:"getCurrentToolName",value:function(){return this.currentTool.name()}},{key:"registerTool",value:function(t){this.tools[t.name()]=t,t.setEditor(this.editor)}},{key:"bindToolEvent",value:function(){var t=this,e=this.editor.svgRoot;e.addEventListener("mousedown",(function(e){var n=new Ct(t.editor,e);t.ctx=n;var r=t.currentTool.cursorPress();t.editor.setCursor(r),t.currentTool.start(n)}),!1),e.addEventListener("mousemove",(function(e){var n=t.ctx;n&&(n.setOriginEvent(e),n.pressMouse(),t.currentTool.move(n))}),!1),e.addEventListener("mouseup",(function(e){var n=t.ctx,r=t.currentTool.cursorNormal();t.editor.setCursor(r),t.currentTool.end(n),n.isEndInside=!0}),!1),window.addEventListener("mouseup",(function(e){t.ctx&&0==t.ctx.isEndInside&&t.currentTool.endOutside(t.ctx),t.ctx=null}),!1)}}])&&St(e.prototype,n),r&&St(e,r),t}();var Ot=new j;window.editor=Ot;var At=new gt(Ot);Ot.setCommandManager(At),Ot.setSetting(new mt);var Pt=new Mt(Ot);Ot.setToolManager(Pt),Pt.registerTool(new L),Pt.registerTool(new X),Pt.registerTool(new xt),Ot.toolManager.onSwitchTool((function(t){console.log("switched tool:",t),function(t){if(null!=(t={select:"btn-select",addRect:"btn-add-rect",dragCanvas:"btn-drag-canvas"}[t])){var e=document.querySelector("#tool-bar");Array.prototype.slice.call(e.children).forEach((function(t){t.classList.remove("active")})),document.getElementById(t).classList.add("active")}}(t)})),Pt.setCurrentTool("addRect"),Pt.bindToolEvent(),Ot.setZoomManager(new kt),Ot.mount("#editor-area"),document.querySelector("#btn-undo").onclick=function(){Ot.executeCommand("undo")},document.querySelector("#btn-redo").onclick=function(){Ot.executeCommand("redo")},document.querySelector("#btn-zoom-in").onclick=function(){Ot.zoomManager.zoomIn()},document.querySelector("#btn-zoom-out").onclick=function(){Ot.zoomManager.zoomOut()},document.querySelector("#btn-add-rect").onclick=function(){Ot.setCurrentTool("addRect")},document.querySelector("#btn-drag-canvas").onclick=function(){Ot.setCurrentTool("dragCanvas")},document.querySelector("#btn-select").onclick=function(){Ot.setCurrentTool("select")},document.querySelector("#btn-delete").onclick=function(){Ot.activedElsManager.isNoEmpty()&&Ot.executeCommand("removeSelectedElements")},document.querySelector("#btn-front").onclick=function(){Ot.activedElsManager.isNoEmpty()&&Ot.executeCommand("front")},document.querySelector("#btn-forward").onclick=function(){Ot.activedElsManager.isNoEmpty()&&Ot.executeCommand("forward")},document.querySelector("#btn-backward").onclick=function(){Ot.activedElsManager.isNoEmpty()&&Ot.executeCommand("backward")},document.querySelector("#btn-back").onclick=function(){Ot.activedElsManager.isNoEmpty()&&Ot.executeCommand("back")};var Tt=document.querySelector("#element-info-fill");Tt.innerHTML=Ot.setting.get("fill"),Ot.setting.bindEvent("fill",(function(t){Tt.innerHTML=t})),document.querySelector("#set-fill-btn").onclick=function(){var t=window.prompt("Please input valid color value（like #ffce43）",Ot.setting.get("fill"));t&&(Tt.innerHTML=t,Ot.setting.setFill(t),Ot.activedElsManager.setElsAttr("fill",t))};var _t=document.querySelector("#element-info-stroke");_t.innerHTML=Ot.setting.get("stroke"),Ot.setting.bindEvent("stroke",(function(t){_t.innerHTML=t})),document.querySelector("#set-stroke-btn").onclick=function(){var t=window.prompt("Please input valid color value（like #ffce43）",Ot.setting.get("stroke"));t&&(_t.innerHTML=t,Ot.setting.setStroke(t),Ot.activedElsManager.setElsAttr("stroke",t))},Ot.shortcut.register("Undo","Cmd+Z",(function(){Ot.executeCommand("undo")})),Ot.shortcut.register("Undo","Ctrl+Z",(function(){Ot.executeCommand("undo")})),Ot.shortcut.register("Redo","Cmd+Shift+Z",(function(){Ot.executeCommand("redo")})),Ot.shortcut.register("Redo","Ctrl+Shift+Z",(function(){Ot.executeCommand("redo")})),Ot.shortcut.register("Delete","Backspace",(function(){Ot.activedElsManager.isNoEmpty()&&Ot.executeCommand("removeSelectedElements")})),document.querySelector("#shortcut").innerHTML=Ot.shortcut.formatPrint()})()})();