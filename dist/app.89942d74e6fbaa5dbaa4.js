(()=>{"use strict";var t,e=function(){function t(t,e,n,o){"object"==typeof t?(this.x=t.x,this.y=t.y,this.w=t.width,this.h=t.height):(this.x=t,this.y=e,this.w=n,this.h=o),this.width=this.w,this.height=this.h,this.x2=this.x+this.w,this.y2=this.y+this.h}return t.prototype.contains=function(t){return this.x<=t.x&&this.y<=t.y&&this.x2>=t.x+t.width&&this.y2>=t.y+t.height},t.prototype.merge=function(e){var n=Math.min(this.x,e.x),o=Math.min(this.y,e.y);return new t(n,o,Math.max(this.x2,e.x2)-n,Math.max(this.y2,e.y2)-o)},t}(),n="http://www.w3.org/2000/svg",o=function(){function t(){this.el_=null}return t.prototype.el=function(){return this.el_},t.prototype.setAttr=function(t,e){return this.el_.setAttribute(t,e)},t.prototype.getAttr=function(t){return this.el_.getAttribute(t)},t.prototype.getBBox=function(){return this.el_.getBBox()},t.prototype.remove=function(){return this.el_.remove()},t.prototype.equal=function(t){return t.el&&(t=t.el()),this.el_===t},t.prototype.parent=function(){var t=this.el_.parentElement;if(t instanceof SVGElement)return a.create(t);throw new Error("parent is not SVGElement")},t.prototype.nextSibling=function(){var t=this.el_.nextElementSibling;return null===t?null:a.create(t)},t.prototype.previousSibling=function(){var t=this.el_.previousElementSibling;return null===t?null:a.create(t)},t.prototype.append=function(t){this.el_.appendChild(t.el())},t.prototype.front=function(){this.el_.parentElement.appendChild(this.el_)},t.prototype.back=function(){var t=this.el_.parentElement,e=t.firstElementChild;e&&t.insertBefore(this.el_,e)},t.prototype.forward=function(){var t=this.el_.parentElement,e=this.el_.nextSibling;e&&t.insertBefore(e,this.el_)},t.prototype.backward=function(){var t=this.el_.previousElementSibling;t&&this.before(t)},t.prototype.before=function(t){t.el&&(t=t.el()),t.parentElement.insertBefore(this.el_,t)},t.prototype.after=function(t){t.el&&(t=t.el());var e=t.parentElement,n=t.nextSibling;n?e.insertBefore(this.el_,n):e.appendChild(this.el_)},t.prototype.getPos=function(){return{x:parseFloat(this.getAttr("x")),y:parseFloat(this.getAttr("y"))}},t.prototype.dmove=function(t,e){var n=this.getPos();this.setAttr("x",n.x+t+""),this.setAttr("y",n.y+e+"")},t}(),r=(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)},function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}),i=function(t){function e(e,o,r,i){var s=t.call(this)||this;return"object"==typeof e?s.el_=e:(s.el_=document.createElementNS(n,"rect"),s.setAttr("x",e+""),s.setAttr("y",o+""),s.setAttr("width",r+""),s.setAttr("height",i+"")),s}return r(e,t),e}(o),s=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();var a={create:function(t){var e=t.tagName;if("rect"===e)return new a.Rect(t);if("g"===e)return new a.Group(t);throw new Error("Can not creat "+e+" instance, no match class.")},Rect:i,Box:e,Group:function(t){function e(e){var o=t.call(this)||this;return o.el_=e||document.createElementNS(n,"g"),o}return s(e,t),e}(o)};var c=function(){function t(t){this.editor=t,this.els=[]}return t.prototype.setEls=function(t){Array.isArray(t)||(t=[t]),this.els=t,this.heighligthEls(),this.setSetting("fill"),this.setSetting("stroke"),this.setSetting("stroke-width")},t.prototype.getEls=function(){return this.els},t.prototype.setElsInBox=function(t){if(0!==t.width&&0!==t.height){var e=function(t,e){var n=["g"];t=new a.Box(t);var o=[];return function t(e,r){for(var i=r.children,s=0;s<i.length;s++){var c=i[s];if(!n.includes(c.tagName)){var u=c.getBBox();e.contains(u)&&o.push(a.create(c))}c.children.length>0&&t(e,c)}}(t,e),o}(t,this.editor.svgContent);0===e.length?this.clear():this.setEls(e)}else this.clear()},t.prototype.isEmpty=function(){return 0==this.els.length},t.prototype.isNoEmpty=function(){return this.els.length>0},t.prototype.clear=function(){this.els=[],this.editor.hudManager.outlineBoxHud.clear()},t.prototype.contains=function(t){for(var e=0;e<this.els.length;e++)if(this.els[e].el()===t)return!0;return!1},t.prototype.getMergeBBox=function(){},t.prototype.heighligthEls=function(){var t=this.els,e=this.editor.hudManager,n=new a.Box(t[0].getBBox()),o=t.reduce((function(t,e){var n=e.getBBox();return t.merge(new a.Box(n))}),n);e.outlineBoxHud.drawRect(o.x,o.y,o.width,o.height)},t.prototype.setSetting=function(t){var e=this.els.map((function(e){return e.getAttr(t)}));this.editor.setting.set(t,e[0])},t.prototype.setElsAttr=function(t,e){this.isNoEmpty()&&(console.log(t,e),this.editor.executeCommand("setAttr",this.els,t,e))},t}(),u=function(){function t(t){this.x=0,this.y=0,this.w=0,this.h=0,this.x=0,this.y=0,this.w=0,this.h=0,this.container=document.createElementNS(n,"g"),this.container.id="outline-box-hud",t.appendChild(this.container),this.outline=document.createElementNS(n,"path"),this.outline.setAttribute("fill","none"),this.outline.setAttribute("stroke","#f04"),this.outline.setAttribute("vector-effect","non-scaling-stroke"),this.container.appendChild(this.outline)}return t.prototype.clear=function(){this.outline.style.display="none"},t.prototype.drawRect=function(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o;var r="M "+t+" "+e+" L "+(t+n)+" "+e+" L "+(t+n)+" "+(e+o)+" L "+t+" "+(e+o)+" Z";this.outline.setAttribute("d",r),this.outline.style.display=""},t.prototype.getWidth=function(){return this.w},t.prototype.getHeight=function(){return this.h},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t}(),l=function(){function t(t){this.x=0,this.y=0,this.w=0,this.h=0,this.container=document.createElementNS(n,"g"),this.container.id="select-area",t.appendChild(this.container),this.outline=document.createElementNS(n,"path"),this.outline.setAttribute("fill","none"),this.outline.setAttribute("stroke","#054"),this.outline.setAttribute("vector-effect","non-scaling-stroke"),this.outline.setAttribute("stroke-dasharray","4px"),this.container.appendChild(this.outline)}return t.prototype.clear=function(){this.x=this.y=this.w=this.h=0,this.outline.style.display="none"},t.prototype.drawRect=function(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o;var r="M "+t+" "+e+" L "+(t+n)+" "+e+" L "+(t+n)+" "+(e+o)+" L "+t+" "+(e+o)+" Z";this.outline.setAttribute("d",r),this.outline.style.display=""},t.prototype.getWidth=function(){return this.w},t.prototype.getHeight=function(){return this.h},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getBox=function(){return{x:this.x,y:this.y,width:this.w,height:this.h,w:this.w,h:this.h}},t}();function h(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var p=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=document.createElementNS(n,"g"),this.container.id="huds",this.selectArea=new l(this.container),this.outlineBoxHud=new u(this.container)}var e,o,r;return e=t,(o=[{key:"mount",value:function(t){t.appendChild(this.container)}}])&&h(e.prototype,o),r&&h(e,r),t}(),d=function(){function t(t){var e=this;this.editor=t,this.registeredFns={},window.addEventListener("keydown",(function(t){var n=function(t){var e=[];t.ctrlKey&&e.push("Ctrl");t.metaKey&&e.push("Cmd");t.shiftKey&&e.push("Shift");/Key./.test(t.code)?e.push(t.code[t.code.length-1]):e.push(t.code);return e.join("+")}(t),o=e.registeredFns[n];o&&(console.log(n),t.preventDefault(),o.fn(t))}),!1)}return t.prototype.register=function(t,e,n){this.registeredFns[e]={cmdName:t,fn:n}},t.prototype.formatPrint=function(){var t=[];for(var e in this.registeredFns){var n=this.registeredFns[e].cmdName;t.push(n+": "+e)}return t.join(", ")},t}();function f(t){var e=t.getAttribute("viewBox");if(!e)throw new Error("has not viewBox attribute");var n=e.split(/[\s,]+/).map((function(t){return parseFloat(t)}));return{x:n[0],y:n[1],w:n[2],h:n[3]}}var g=function(){function t(t){this.editor=t}return t.prototype.getScroll=function(){return{x:this.editor.svgContainer.scrollLeft,y:this.editor.svgContainer.scrollTop}},t.prototype.setScroll=function(t,e){this.editor.svgContainer.scrollLeft=t,this.editor.svgContainer.scrollTop=e},t.prototype.getContentOffset=function(){return{x:parseFloat(this.editor.svgStage.getAttribute("x")),y:parseFloat(this.editor.svgStage.getAttribute("y"))}},t.prototype.getZoom=function(){return parseFloat(this.editor.svgRoot.getAttribute("width"))/f(this.editor.svgRoot).w},t.prototype.setZoom=function(t,e,n){console.log(t);var o=f(this.editor.svgRoot),r=o.w*t,i=o.h*t;this.editor.svgRoot.setAttribute("width",r+""),this.editor.svgRoot.setAttribute("height",i+"")},t.prototype.zoomIn=function(t,e){var n=this.getZoom();this.setZoom(n+.1,t,e)},t.prototype.zoomOut=function(t,e){var n=this.getZoom();this.setZoom(n-.1,t,e)},t.prototype.center=function(){var t=this.getSVGRootBox("width"),e=this.getSVGRootBox("height"),n=this.getViewportBox("width"),o=this.getViewportBox("height");this.setScroll((t-n)/2,(e-o)/2)},t.prototype.getViewportBox=function(t){return parseFloat(this.editor.viewportElement.style[t])},t.prototype.getSVGRootBox=function(t){return parseFloat(this.editor.svgRoot.getAttribute(t))},t}(),y=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o};const v=function(){function t(){this.setting=null,this.commandManager=null,this.activedElsManager=new c(this),this.shortcut=new d(this),this.toolManager=null,this.viewport=new g(this);var t=document.createElement("div");t.id="viewportElement",t.style.border="1px solid #000",t.style.width="800px",t.style.height="550px",this.viewportElement=t;var e=document.createElement("div");e.id="svg-container",e.style.backgroundColor="#ddd",e.style.width="800px",e.style.height="550px",e.style.overflow="scroll",this.svgContainer=e;var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.id="svg-root",n.setAttribute("width","1000"),n.setAttribute("height","600"),n.setAttribute("viewBox","0 0 1000 600"),this.svgRoot=n;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.id="svg-stage",o.setAttribute("width","500"),o.setAttribute("height","400"),o.setAttribute("x",Math.floor(250)+""),o.setAttribute("y",Math.floor(100)+""),o.style.overflow="visible",this.svgStage=o;var r=document.createElementNS("http://www.w3.org/2000/svg","g");r.id="background",r.setAttribute("x","0"),r.setAttribute("y","0");var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill","#fff");var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.id="content",s.setAttribute("x","0"),s.setAttribute("y","0"),this.svgContent=s;var a=document.createElementNS("http://www.w3.org/2000/svg","g");a.id="layer-1",this.currentLayer=a,t.appendChild(e),e.appendChild(n),n.appendChild(o),o.appendChild(r),r.appendChild(i),o.appendChild(s),s.appendChild(a),this.hudManager=new p,this.hudManager.mount(o)}return t.prototype.mount=function(t){document.querySelector(t).appendChild(this.viewportElement)},t.prototype.getCurrentLayer=function(){return this.currentLayer},t.prototype.setToolManager=function(t){this.toolManager=t},t.prototype.setCurrentTool=function(t){this.toolManager.setCurrentTool(t)},t.prototype.registerTool=function(t){this.toolManager.registerTool(t)},t.prototype.setSetting=function(t){this.setting=t},t.prototype.setCursor=function(t){this.svgRoot.style.cursor=t},t.prototype.setCommandManager=function(t){this.commandManager=t},t.prototype.executeCommand=function(t){for(var e,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"undo"!=t?"redo"!=t?(e=this.commandManager).execute.apply(e,y([t],n)):this.commandManager.redo():this.commandManager.undo()},t.prototype.isContentElement=function(t){for(;t;){if(t.parentElement==this.svgContent)return!0;if(t.parentElement==this.svgRoot)return!1;t=t.parentElement}return!1},t}();function m(t,e,n,o){var r,i;return r=Math.abs(n-t),i=Math.abs(o-e),{x:Math.min(n,t),y:Math.min(o,e),w:r,h:i}}var w=function(){function t(){}return t.prototype.setEditor=function(t){this.editor=t},t}(),E=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const x=function(t){function e(){var e=t.call(this)||this;return e.editor=null,e}return E(e,t),e.prototype.name=function(){return"addRect"},e.prototype.cursorNormal=function(){return"crosshair"},e.prototype.cursorPress=function(){return"crosshair"},e.prototype.start=function(){},e.prototype.move=function(t){var e=t.getPos(),n=e.x,o=e.y,r=t.getStartPos(),i=m(r.x,r.y,n,o),s=i.x,a=i.y,c=i.w,u=i.h;this.editor.hudManager.outlineBoxHud.drawRect(s,a,c,u)},e.prototype.end=function(t){this.editor.hudManager.outlineBoxHud.clear();var e=t.getPos(),n=e.x,o=e.y,r=t.getStartPos(),i=m(r.x,r.y,n,o),s=i.x,a=i.y,c=i.w,u=i.h;c<2&&u<2?console.log("width and height both less equal to 2，drawing nothing"):this.editor.executeCommand("addRect",s,a,c,u)},e.prototype.endOutside=function(){this.editor.hudManager.outlineBoxHud.clear()},e}(w);var b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),S=function(t){function e(){var e=t.call(this)||this;return e.startOffsetX=0,e.startOffsetY=0,e}return b(e,t),e.prototype.name=function(){return"dragCanvas"},e.prototype.cursorNormal=function(){return"grab"},e.prototype.cursorPress=function(){return"grabbing"},e.prototype.beforeActive=function(){},e.prototype.start=function(){var t=this.editor.viewport.getScroll();this.startOffsetX=t.x,this.startOffsetY=t.y},e.prototype.move=function(t){this.editor.viewport.getZoom();var e=t.getDiffPos(),n=e.x,o=e.y;this.editor.viewport.setScroll(this.startOffsetX-n,this.startOffsetY-o)},e.prototype.end=function(){},e.prototype.endOutside=function(){},e}(w),C=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(){function t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.editor=t}return t.prototype.afterRedo=function(){},t.prototype.afterUndo=function(){},t}(),M=function(t){function e(e,n,o,r,i){var s=t.call(this,e)||this,c=new a.Rect(n,o,r,i),u=e.setting.get("fill"),l=e.setting.get("stroke"),h=e.setting.get("stroke-width");return c.setAttr("fill",u),c.setAttr("stroke",l),c.setAttr("stroke-width",h),e.getCurrentLayer().appendChild(c.el()),s.nextSibling=c.el().nextElementSibling,s.parent=c.el().parentElement,s.rect=c,s.editor.activedElsManager.setEls(s.rect),s}return C(e,t),e.cmdName=function(){return"addRect"},e.prototype.redo=function(){var t=this.rect.el();this.nextSibling?this.parent.insertBefore(t,this.nextSibling):this.parent.appendChild(t),this.editor.activedElsManager.setEls(this.rect)},e.prototype.undo=function(){this.rect.el().remove(),this.editor.activedElsManager.clear()},e}(A),_=function(t){function e(e){var n=t.call(this,e)||this;n.els=n.editor.activedElsManager.getEls();var o=n.els.length;return n.parents=new Array(o),n.nextSiblings=new Array(o),n.els.forEach((function(t,e){n.nextSiblings[e]=t.el().nextElementSibling,n.parents[e]=t.el().parentElement})),n.execute(),n}return C(e,t),e.cmdName=function(){return"removeSelectedElements"},e.prototype.execute=function(){this.els.forEach((function(t){t.remove()})),this.editor.activedElsManager.clear()},e.prototype.redo=function(){this.execute()},e.prototype.undo=function(){for(var t=this.els.length-1;t>=0;t--){var e=this.els[t].el();this.nextSiblings[t]?this.parents[t].insertBefore(e,this.nextSiblings[t]):this.parents[t].appendChild(e)}this.editor.activedElsManager.setEls(this.els)},e}(A),k=function(t){function e(e,n,o,r){var i=t.call(this,e)||this;return i.dx=o,i.dy=r,i.els=n,i.els.forEach((function(t){t.dmove(i.dx,i.dy)})),i}return C(e,t),e.cmdName=function(){return"dmove"},e.prototype.redo=function(){var t=this;this.els.forEach((function(e){e.dmove(t.dx,t.dy)}))},e.prototype.undo=function(){var t=this;this.els.forEach((function(e){e.dmove(-t.dx,-t.dy)}))},e.prototype.afterRedo=function(){this.editor.activedElsManager.setEls(this.els)},e.prototype.afterUndo=function(){this.editor.activedElsManager.setEls(this.els)},e}(A),O=function(t){function e(e,n,o,r){var i=t.call(this,e)||this;return Array.isArray(n)||(n=[n]),i.els=n,i.attrName=o,i.beforeVal=i.els.map((function(t){return t.getAttr(o)})),i.afterVal=r,i.els.forEach((function(t){t.setAttr(o,r)})),i}return C(e,t),e.cmdName=function(){return"setAttr"},e.prototype.redo=function(){var t=this;this.els.forEach((function(e){e.setAttr(t.attrName,t.afterVal)}))},e.prototype.undo=function(){var t=this;this.els.forEach((function(e,n){e.setAttr(t.attrName,t.beforeVal[n])}))},e}(A),N=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),B=function(t){function e(e,n){var o=t.call(this,e)||this;if(o.els=void 0===n?e.activedElsManager.getEls():n,0===o.els.length)throw new Error("elements can not be empty.");o.nextSiblings=new Array(o.els.length);for(var r=0;r<o.els.length;r++){var i=o.els[r];o.nextSiblings[r]=i.nextSibling(),i.front()}return o}return N(e,t),e.cmdName=function(){return"front"},e.prototype.undo=function(){for(var t=this.els.length-1;t>=0;t--){var e=this.els[t],n=this.nextSiblings[t];null!==n&&e.before(n)}},e.prototype.redo=function(){for(var t=0;t<this.els.length;t++){this.els[t].front()}},e}(A),P=function(t){function e(e,n){var o=t.call(this,e)||this;if(o.els=void 0===n?e.activedElsManager.getEls():n,0===o.els.length)throw new Error("elements can not be empty.");o.previousSiblings=new Array(o.els.length);for(var r=o.els.length-1;r>=0;r--){var i=o.els[r];o.previousSiblings[r]=i.previousSibling()}return o.exec(),o}return N(e,t),e.cmdName=function(){return"back"},e.prototype.undo=function(){for(var t=this.els.length,e=0;e<t;e++){var n=this.els[e],o=this.previousSiblings[e];null!==o&&n.after(o)}},e.prototype.redo=function(){this.exec()},e.prototype.exec=function(){for(var t=this.els.length-1;t>=0;t--){this.els[t].back()}},e}(A),T=function(t){function e(e,n){var o=t.call(this,e)||this;if(o.els=void 0===n?e.activedElsManager.getEls():n,0===o.els.length)throw new Error("elements can not be empty.");return o.exec(),o}return N(e,t),e.cmdName=function(){return"forward"},e.prototype.exec=function(){for(var t=null,e=this.els.length-1;e>=0;e--){var n=this.els[e],o=n.el().nextElementSibling;null!==t&&o===t||o&&n.after(o),t=n.el()}},e.prototype.undo=function(){for(var t=null,e=0;e<this.els.length;e++){var n=this.els[e],o=n.el().previousElementSibling;null!==t&&o===t||o&&n.before(o),t=n.el()}},e.prototype.redo=function(){this.exec()},e}(A),R=function(t){function e(e,n){var o=t.call(this,e)||this;if(o.els=void 0===n?e.activedElsManager.getEls():n,0===o.els.length)throw new Error("elements can not be empty.");return o.exec(),o}return N(e,t),e.cmdName=function(){return"backward"},e.prototype.exec=function(){for(var t=null,e=0;e<this.els.length;e++){var n=this.els[e],o=n.el().previousElementSibling;null!==t&&o===t||o&&n.before(o),t=n.el()}},e.prototype.undo=function(){for(var t=null,e=this.els.length-1;e>=0;e--){var n=this.els[e],o=n.el().nextElementSibling;null!==t&&o===t||o&&n.after(o),t=n.el()}},e.prototype.redo=function(){this.exec()},e}(A),L=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o};const j=function(){function t(t){this.editor=t,this.redoStack=[],this.undoStack=[],this.commandClasses={},this.resigterCommandClass(M,M.cmdName()),this.resigterCommandClass(k,k.cmdName()),this.resigterCommandClass(O,O.cmdName()),this.resigterCommandClass(_,_.cmdName()),this.resigterCommandClass(B,B.cmdName()),this.resigterCommandClass(P,P.cmdName()),this.resigterCommandClass(T,T.cmdName()),this.resigterCommandClass(R,R.cmdName())}return t.prototype.setEditor=function(t){this.editor=t},t.prototype.execute=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=this.commandClasses[t];if(!o)throw new Error("editor has not the "+t+" command");var r=new(o.bind.apply(o,L([void 0,this.editor],e)));this.undoStack.push(r),this.redoStack=[]},t.prototype.undo=function(){if(0!==this.undoStack.length){var t=this.undoStack.pop();this.redoStack.push(t),t.undo(),t.afterUndo()}else console.log("undo stack is empty, can not undo")},t.prototype.redo=function(){if(0!==this.redoStack.length){var t=this.redoStack.pop();this.undoStack.push(t),t.redo(),t.afterRedo()}else console.log("redo stack is empty, can not redo")},t.prototype.resigterCommandClass=function(t,e){this.commandClasses[e]=t},t.prototype.afterAnyUndo=function(){},t}();var H=function(){function t(){this.setting={},this.bindedEventFns={},this.setFill("#fff"),this.setStroke("#000"),this.set("stroke-width","1px")}return t.prototype.setFill=function(t){this.set("fill",t)},t.prototype.setStroke=function(t){this.set("stroke",t)},t.prototype.set=function(t,e){this.setting[t]=e;var n=this.bindedEventFns[t];n&&n.forEach((function(t){t(e)}))},t.prototype.get=function(t){return this.setting[t]},t.prototype.bindEvent=function(t,e){this.bindedEventFns[t]||(this.bindedEventFns[t]=[]),this.bindedEventFns[t].push(e)},t}(),F=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),X=function(t){function e(){var e=t.call(this)||this;return e.selectedEls=[],e.outlineStartX=0,e.outlineStartY=0,e}return F(e,t),e.prototype.name=function(){return"select"},e.prototype.cursorNormal=function(){return"default"},e.prototype.cursorPress=function(){return"default"},e.prototype.hasSelectedElsWhenStart=function(){return this.selectedEls.length>0},e.prototype.start=function(t){var e=t.originEvent.target;if(this.editor.isContentElement(e)){var n=a.create(e),o=this.editor.activedElsManager;o.contains(e)?o.heighligthEls():o.setEls(n),this.selectedEls=o.getEls();var r=this.editor.hudManager.outlineBoxHud;this.outlineStartX=r.getX(),this.outlineStartY=r.getY()}},e.prototype.move=function(t){if(this.hasSelectedElsWhenStart()){var e=t.getDiffPos(),n=e.x,o=e.y,r=this.editor.hudManager.outlineBoxHud,i=r.getWidth(),s=r.getHeight();r.drawRect(this.outlineStartX+n,this.outlineStartY+o,i,s)}else{var a=t.getPos(),c=a.x,u=a.y,l=t.getStartPos(),h=m(l.x,l.y,c,u),p=h.x,d=h.y,f=h.w,g=h.h;this.editor.hudManager.selectArea.drawRect(p,d,f,g)}},e.prototype.end=function(t){if(!this.hasSelectedElsWhenStart()){var e=this.editor.hudManager.selectArea.getBox();return this.editor.hudManager.selectArea.clear(),void this.editor.activedElsManager.setElsInBox(e)}this.editor.hudManager.outlineBoxHud.clear();var n=t.getDiffPos(),o=n.x,r=n.y;this.editor.executeCommand("dmove",this.selectedEls,o,r),this.editor.activedElsManager.setEls(this.selectedEls),this.selectedEls=[]},e.prototype.endOutside=function(){this.editor.hudManager.outlineBoxHud.clear(),this.editor.hudManager.selectArea.clear(),this.editor.activedElsManager.clear(),this.selectedEls=[]},e}(w),Y=function(){function t(t,e){this.editor=t,this.mousePressed=!1,this.originEvent=e,this.isEndInside=!1,this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.startClientX=0,this.startClientY=0,this.dx=0,this.dy=0,this.setStartPos()}return t.prototype.setOriginEvent=function(t){this.originEvent=t},t.prototype.setStartPos=function(){var t=this.getPos(),e=t.x,n=t.y;this.startX=e,this.startY=n,this.startClientX=this.originEvent.clientX,this.startClientY=this.originEvent.clientY},t.prototype.releaseMouse=function(){this.mousePressed=!1},t.prototype.pressMouse=function(){this.mousePressed=!0},t.prototype.getPos=function(){var t=this.editor.viewport.getZoom(),e=this.editor.viewport.getContentOffset(),n=e.x,o=e.y;return{x:this.originEvent.offsetX/t-n,y:this.originEvent.offsetY/t-o}},t.prototype.getStartPos=function(){return{x:this.startX,y:this.startY}},t.prototype.getDiffPos=function(){return{x:this.originEvent.clientX-this.startClientX,y:this.originEvent.clientY-this.startClientY}},t}(),Z=function(){function t(t){this.editor=t,this.tools={},this.currentTool=null,this.invokeWhenSwitch=function(){},this.ctx=null}return t.prototype.setCurrentTool=function(t){this.currentTool=this.tools[t];var e=this.currentTool.cursorNormal();this.editor.setCursor(e);var n=this.getCurrentToolName();this.invokeWhenSwitch(n)},t.prototype.onSwitchTool=function(t){this.invokeWhenSwitch=t},t.prototype.getCurrentToolName=function(){return this.currentTool.name()},t.prototype.registerTool=function(t){this.tools[t.name()]=t,t.setEditor(this.editor)},t.prototype.bindToolEvent=function(){var t=this,e=this.editor.svgRoot;e.addEventListener("mousedown",(function(e){var n=new Y(t.editor,e);t.ctx=n;var o=t.currentTool.cursorPress();t.editor.setCursor(o),t.currentTool.start(n)}),!1),e.addEventListener("mousemove",(function(e){var n=t.ctx;n&&(n.setOriginEvent(e),n.pressMouse(),t.currentTool.move(n))}),!1),e.addEventListener("mouseup",(function(e){var n=t.ctx,o=t.currentTool.cursorNormal();t.editor.setCursor(o),t.currentTool.end(n),n.isEndInside=!0}),!1),window.addEventListener("mouseup",(function(){t.ctx&&0==t.ctx.isEndInside&&t.currentTool.endOutside(t.ctx),t.ctx=null}),!1)},t}();var V=new v;window.editor=V;var q=new j(V);V.setCommandManager(q),V.setSetting(new H);var W=new Z(V);function I(t,e){document.querySelector(t).onclick=e}V.setToolManager(W),W.registerTool(new x),W.registerTool(new S),W.registerTool(new X),V.toolManager.onSwitchTool((function(t){console.log("switched tool:",t),function(t){var e={select:"btn-select",addRect:"btn-add-rect",dragCanvas:"btn-drag-canvas"}[t];if(null!=t){var n=document.querySelector("#tool-bar");Array.prototype.slice.call(n.children).forEach((function(t){t.classList.remove("active")})),document.getElementById(e).classList.add("active")}}(t)})),W.setCurrentTool("addRect"),W.bindToolEvent(),V.mount("#editor-area"),V.viewport.center(),I("#btn-undo",(function(){V.executeCommand("undo")})),I("#btn-redo",(function(){V.executeCommand("redo")})),I("#btn-zoom-in",(function(){V.viewport.zoomIn()})),I("#btn-zoom-out",(function(){V.viewport.zoomOut()})),I("#btn-add-rect",(function(){V.setCurrentTool("addRect")})),I("#btn-drag-canvas",(function(){V.setCurrentTool("dragCanvas")})),I("#btn-select",(function(){V.setCurrentTool("select")})),I("#btn-delete",(function(){V.activedElsManager.isNoEmpty()&&V.executeCommand("removeSelectedElements")})),I("#btn-front",(function(){V.activedElsManager.isNoEmpty()&&V.executeCommand("front")})),I("#btn-forward",(function(){V.activedElsManager.isNoEmpty()&&V.executeCommand("forward")})),I("#btn-backward",(function(){V.activedElsManager.isNoEmpty()&&V.executeCommand("backward")})),I("#btn-back",(function(){V.activedElsManager.isNoEmpty()&&V.executeCommand("back")}));var G=document.querySelector("#element-info-fill");G.innerHTML=V.setting.get("fill"),V.setting.bindEvent("fill",(function(t){G.innerHTML=t})),I("#set-fill-btn",(function(){var t=window.prompt("Please input valid color value（like #ffce43）",V.setting.get("fill"));t&&(G.innerHTML=t,V.setting.setFill(t),V.activedElsManager.setElsAttr("fill",t))}));var z=document.querySelector("#element-info-stroke");z.innerHTML=V.setting.get("stroke"),V.setting.bindEvent("stroke",(function(t){z.innerHTML=t})),I("#set-stroke-btn",(function(){var t=window.prompt("Please input valid color value（like #ffce43）",V.setting.get("stroke"));t&&(z.innerHTML=t,V.setting.setStroke(t),V.activedElsManager.setElsAttr("stroke",t))}));var D=document.querySelector("#element-info-stroke-width");D.innerHTML=V.setting.get("stroke-width"),V.setting.bindEvent("stroke-width",(function(t){D.innerHTML=t})),I("#set-stroke-width-btn",(function(){var t=window.prompt("Please input value(like 6px)",V.setting.get("stroke-width"));t&&(D.innerHTML=t,V.setting.set("stroke-width",t),V.activedElsManager.setElsAttr("stroke-width",t))})),V.shortcut.register("Undo","Cmd+Z",(function(){V.executeCommand("undo")})),V.shortcut.register("Undo","Ctrl+Z",(function(){V.executeCommand("undo")})),V.shortcut.register("Redo","Cmd+Shift+Z",(function(){V.executeCommand("redo")})),V.shortcut.register("Redo","Ctrl+Shift+Z",(function(){V.executeCommand("redo")})),V.shortcut.register("Delete","Backspace",(function(){V.activedElsManager.isNoEmpty()&&V.executeCommand("removeSelectedElements")})),document.querySelector("#shortcut").innerHTML=V.shortcut.formatPrint()})();